function CCheckout(){var t={form:null,fields:null,fields:null,storage:new Object,construct:function(){var t=this;t.form=$("#checkoutForm"),t.fields=t.form.find("input,select,textarea");var e=window.localStorage.getItem("checkoutFormData");null!==e&&(t.storage=JSON.parse(e))},destruct:function(){var t=this;return window.localStorage.setItem("checkoutFormData",JSON.stringify(t.storage)),!0},setup:function(){var t=this;t.construct(),t.form.find('input[type="tel"]').inputmask({mask:"+38 999 999-99-99",greedy:!1,definitions:{"*":{validator:"[0-9 ]",cardinality:1,casing:"lower"}}}),t.form.on("change blur",".requiredfield",function(){var e=$(this).val(),n=$(this).attr("name");"shipping_id"==n&&t.setShipping(e),"payment_id"==n&&t.setPayment(e),"name"==n&&t.setRecepient(e)}).on("submit",function(){return t.validate()}),t.form.find("#city").autocomplete({source:function(e,n){$.ajax({url:t.form.attr("action"),type:"GET",dataType:"json",data:{raw:e.term,action:"getCities"},success:function(t){console.log(t),n($.map(t.items,function(t){return{value:t.DescriptionRu,label:t.DescriptionRu}}))}})},minLength:3,delay:300}),t.form.find("#address").autocomplete({source:function(e,n){$.ajax({url:t.form.attr("action"),type:"GET",dataType:"json",data:{raw:e.term,city:t.form.find("#city").val(),action:"getWarehouses"},success:function(t){n($.map(t.items,function(t){return{value:t.DescriptionRu,label:t.DescriptionRu}}))}})},minLength:3,delay:300}),$(window).on("unload",function(){return $.map(t.fields,function(e){var n=$(e).val(),a=$(e).attr("name");t.storage[a]=n}),t.destruct()}),t.fillup()},setRecepient:function(t){var e=this,n=e.form.find("#recepient");!n.val().length&&t.length&&n.val(t).change()},setShipping:function(t){var e=this,n=e.form.find(".toggle-content");$.map(n,function(e){var n=e.localName;$(e).data("shipping-id")==t?($(e).removeClass("hidden"),"input"!=n&&"textarea"!=n&&"select"!=n||$(e).prop("disabled",!1)):($(e).addClass("hidden"),"input"!=n&&"textarea"!=n&&"select"!=n||$(e).prop("disabled",!0))}),Basket.setShipping(t)},setPayment:function(t){var e=this,n=e.form.find(".toggle-content");$.map(n,function(e){var n=e.localName;$(e).data("payment-id")==t?($(e).removeClass("hidden"),"input"!=n&&"textarea"!=n&&"select"!=n||$(e).prop("disabled",!1)):($(e).addClass("hidden"),"input"!=n&&"textarea"!=n&&"select"!=n||$(e).prop("disabled",!0))}),Basket.setPayment(t)},fillup:function(){var t=this;$.map(t.fields,function(e){var n=e.name;n&&array_key_exists(n,t.storage)&&($(e).val(t.storage[n]).trigger("change"),"comment"!=n||empty($(e).val())||$(e).prev(".toggle").addClass("toggle-on"))})},getCities:function(){},getWarehouses:function(){},checkField:function(t){var e=$(t).attr("name"),n=$(t).val(),a=/^\+38\s(044|039|050|063|066|067|068|091|092|093|094|095|096|097|098|099|073)+([\d\s\-]{10})$/,i=0;return $(t).removeClass("error"),(0==n.length||"phone"==e&&null==n.match(a))&&($(t).addClass("error"),i++),i},validate:function(){var t=this,e=(t.form.find(".btn-warning"),0);return $.map(t.form.find(".requiredfield:not(.hidden)"),function(n){e+=t.checkField(n)}),e=Boolean(e),!e}};this.init=function(){return t}}var objCheckout=new CCheckout,Checkout=objCheckout.init();$(function(){Checkout.setup()});